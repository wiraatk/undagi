<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Wedding</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600&family=Great+Vibes&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#A07656', // Gold Bali
                        dark: '#3e2723',
                        light: '#fff8e1',
                    },
                    fontFamily: {
                        sans: ['Lato', 'sans-serif'],
                        serif: ['Cinzel', 'serif'],
                        script: ['Great Vibes', 'cursive'],
                    },
                    animation: {
                        'spin-slow': 'spin 12s linear infinite',
                        'pulse-slow': 'pulse 3s infinite',
                    }
                }
            }
        }
    </script>

    <style>
        body { font-family: 'Lato', sans-serif; overflow-x: hidden; background-color: #1a1a1a; color: #fff; }
        
        /* ORNAMEN BALI / BINGKAI */
        .border-bali {
            border: 1px solid rgba(160, 118, 86, 0.5);
            outline: 1px solid rgba(160, 118, 86, 0.3);
            outline-offset: 4px;
        }

        /* COVER SCREEN */
        #cover-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100vh;
            background-color: #000;
            z-index: 9999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: transform 1.2s cubic-bezier(0.77, 0, 0.175, 1);
        }
        #cover-screen.open { transform: translateY(-100%); }

        /* TEXT SHADOW */
        .text-glow { text-shadow: 0 0 10px rgba(160, 118, 86, 0.8); }
        .vinyl-spin { animation: spin 4s linear infinite; }
        
        /* GLASS BOX UNTUK NAMA TAMU */
        .guest-box {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body>

    <audio id="bgm" loop><source src="" type="audio/mp3"></audio>
    <button id="musicBtn" class="fixed bottom-24 right-6 z-40 w-12 h-12 bg-black/50 backdrop-blur rounded-full border border-primary text-primary flex items-center justify-center hidden hover:scale-110 transition animate-spin-slow" onclick="toggleMusic()">
        <i class="fas fa-compact-disc text-2xl"></i>
    </button>

    <section id="cover-screen" class="bg-cover bg-center relative px-6">
        <div class="absolute inset-0 bg-gradient-to-b from-black/30 via-black/60 to-black/90 z-0"></div>
        <img id="coverBg" src="" class="absolute inset-0 w-full h-full object-cover -z-10 filter brightness-75 transition-transform duration-[20s] ease-linear transform scale-100 hover:scale-110">

        <div class="relative z-10 text-center w-full max-w-md mx-auto border-bali py-12 px-4 rounded-tl-3xl rounded-br-3xl bg-black/20 backdrop-blur-sm" data-aos="zoom-in">
            <p class="text-xs tracking-[0.4em] uppercase mb-6 text-primary font-serif">Pawiwahan</p>
            
            <h1 class="font-script text-6xl mb-4 text-white drop-shadow-lg leading-snug" id="coverNames">...</h1>
            
            <div class="flex items-center justify-center gap-4 mb-8 opacity-80">
                <div class="h-[1px] w-12 bg-white"></div>
                <i class="fas fa-heart text-xs text-primary"></i>
                <div class="h-[1px] w-12 bg-white"></div>
            </div>

            <div class="guest-box p-4 rounded-xl mb-8 max-w-xs mx-auto transform transition hover:scale-105">
                <p class="text-xs text-gray-300 mb-1">Kepada Yth. Bapak/Ibu/Saudara/i:</p>
                <h3 class="text-xl font-bold text-white font-serif tracking-wide" id="guestNameDisplay">Tamu Undangan</h3>
            </div>
            
            <button onclick="openInvitation()" class="px-8 py-3 bg-primary text-white rounded-full font-serif text-sm tracking-widest hover:bg-white hover:text-black transition-all shadow-[0_0_15px_rgba(160,118,86,0.5)] animate-pulse-slow">
                BUKA UNDANGAN
            </button>
        </div>
    </section>

    <main class="relative max-w-md mx-auto bg-[#1a1a1a] min-h-screen shadow-2xl overflow-hidden text-center">
        
        <div class="h-[50vh] relative">
            <img id="headerBg" src="" class="w-full h-full object-cover">
            <div class="absolute inset-0 bg-gradient-to-t from-[#1a1a1a] to-transparent"></div>
            <div class="absolute bottom-0 w-full p-6">
                 <h2 class="font-script text-5xl text-primary" data-aos="fade-up">Om Swastyastu</h2>
            </div>
        </div>

        <section class="px-6 py-10 relative">
            <div class="border-t border-b border-primary/30 py-8" data-aos="fade-up">
                <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/1/1d/Om_symbol.svg/1200px-Om_symbol.svg.png" class="h-12 mx-auto mb-6 opacity-80 filter invert">
                <p class="text-sm leading-relaxed text-gray-300 font-serif italic">
                    "Atas Asung Kertha Wara Nugraha Ida Sang Hyang Widhi Wasa/Tuhan Yang Maha Esa, kami bermaksud menyelenggarakan upacara Pawiwahan (Pernikahan) putra-putri kami."
                </p>
            </div>
        </section>

        <section class="py-10 px-6">
            <div data-aos="fade-right" class="mb-12">
                <div class="w-48 h-64 mx-auto mb-6 p-2 border border-primary/50 rounded-t-full relative">
                    <img id="groomImg" src="" class="w-full h-full object-cover rounded-t-full grayscale hover:grayscale-0 transition duration-700">
                </div>
                <h3 class="text-2xl font-bold text-primary font-serif mb-1" id="groomNameDisplay">...</h3>
                <p class="text-xs text-gray-400 uppercase tracking-widest mb-2">Mempelai Pria</p>
                <p class="text-xs text-gray-500">Putra dari Pasangan<br><span id="groomParents">...</span></p>
            </div>

            <div class="text-4xl text-primary font-script mb-12">&</div>

            <div data-aos="fade-left">
                <div class="w-48 h-64 mx-auto mb-6 p-2 border border-primary/50 rounded-t-full relative">
                    <img id="brideImg" src="" class="w-full h-full object-cover rounded-t-full grayscale hover:grayscale-0 transition duration-700">
                </div>
                <h3 class="text-2xl font-bold text-primary font-serif mb-1" id="brideNameDisplay">...</h3>
                <p class="text-xs text-gray-400 uppercase tracking-widest mb-2">Mempelai Wanita</p>
                <p class="text-xs text-gray-500">Putri dari Pasangan<br><span id="brideParents">...</span></p>
            </div>
        </section>

        <section class="py-16 px-6 bg-[#222] relative">
            <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-primary to-transparent"></div>
            
            <div class="relative z-10" data-aos="zoom-in">
                <h2 class="font-serif text-3xl text-white mb-8 border-b border-primary/30 inline-block pb-2">Rangkaian Acara</h2>

                <div class="mb-10">
                    <h3 class="font-bold text-xl text-primary mb-2 font-serif">Pawiwahan</h3>
                    <div class="flex justify-center gap-4 text-gray-300 mb-4">
                        <div class="flex items-center gap-2"><i class="far fa-calendar"></i> <span id="dateDisplay">...</span></div>
                    </div>
                    <div class="flex justify-center gap-4 text-gray-300 mb-6">
                        <div class="flex items-center gap-2"><i class="far fa-clock"></i> <span id="timeDisplay">...</span></div>
                    </div>
                    <p class="font-bold text-white mb-6 px-4" id="locationDisplay">...</p>
                    
                    <a id="btnMap" href="#" target="_blank" class="px-6 py-2 border border-primary text-primary text-xs font-bold tracking-widest hover:bg-primary hover:text-white transition uppercase">
                        Lihat Lokasi
                    </a>
                </div>

                <div class="grid grid-cols-4 gap-2 text-center max-w-xs mx-auto border-t border-gray-700 pt-6" id="countdown">
                    <div><span class="text-2xl font-serif text-white" id="d">0</span><span class="block text-[9px] text-gray-500">HARI</span></div>
                    <div><span class="text-2xl font-serif text-white" id="h">0</span><span class="block text-[9px] text-gray-500">JAM</span></div>
                    <div><span class="text-2xl font-serif text-white" id="m">0</span><span class="block text-[9px] text-gray-500">MENIT</span></div>
                    <div><span class="text-2xl font-serif text-white" id="s">0</span><span class="block text-[9px] text-gray-500">DETIK</span></div>
                </div>
            </div>
        </section>

        <section class="py-16 px-6 text-center">
            <h2 class="font-serif text-2xl text-primary mb-6">Punia / Kado</h2>
            <p class="text-gray-500 mb-8 text-xs max-w-xs mx-auto">Doa restu Anda merupakan karunia yang sangat berarti bagi kami.</p>
            
            <div class="p-6 border border-gray-700 rounded-xl bg-gray-800/50 max-w-xs mx-auto" data-aos="flip-up">
                <p class="text-sm text-gray-400 mb-2" id="bankNameDisplay">BANK</p>
                <p class="text-2xl font-mono text-white tracking-widest mb-4" id="rekDisplay">0000</p>
                <p class="text-xs text-primary mb-6">a.n <span id="rekHolderDisplay">...</span></p>
                <button onclick="copyRek()" class="text-xs text-white border-b border-white pb-1 hover:text-primary hover:border-primary transition">
                    Salin Nomor Rekening
                </button>
            </div>
        </section>

        <footer class="bg-black py-12 text-center">
            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/1/1d/Om_symbol.svg/1200px-Om_symbol.svg.png" class="h-8 mx-auto mb-4 opacity-50 filter invert">
            <p class="text-primary font-script text-2xl mb-4">Om Shanti Shanti Shanti Om</p>
            <p class="text-[10px] text-gray-600 uppercase tracking-widest">&copy; 2026 Undagi Invitation</p>
        </footer>

    </main>

    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script type="module">
        import { auth, db, doc, getDoc, onAuthStateChanged } from './firebase-config.js';

        AOS.init({ duration: 1000, once: true });

        // MUSIC LOGIC
        const bgm = document.getElementById('bgm');
        const musicBtn = document.getElementById('musicBtn');
        let isPlaying = false;
        
        // Playlist (Bisa diganti lagu gamelan Bali kalau ada linknya)
        const musicLibrary = {
            'romance1.mp3': 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3',
            'acoustic.mp3': 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-8.mp3', 
            'wedding.mp3': 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3'
        };

        window.openInvitation = () => {
            document.getElementById('cover-screen').classList.add('open');
            bgm.play().then(() => {
                isPlaying = true;
                musicBtn.classList.remove('hidden');
            }).catch(e => console.log("Audio blocked"));
        };

        window.toggleMusic = () => {
            if(isPlaying) { bgm.pause(); musicBtn.classList.remove('animate-spin-slow'); }
            else { bgm.play(); musicBtn.classList.add('animate-spin-slow'); }
            isPlaying = !isPlaying;
        };

        window.copyRek = () => {
            navigator.clipboard.writeText(document.getElementById('rekDisplay').innerText);
            Swal.fire({icon:'success', title:'Tersalin', timer:1000, showConfirmButton:false});
        };

        // LOAD DATA
        onAuthStateChanged(auth, async (user) => {
            // 1. AMBIL NAMA TAMU DARI URL (CONTOH: ?to=Budi)
            const urlParams = new URLSearchParams(window.location.search);
            const guestName = urlParams.get('to'); 
            const paramUID = urlParams.get('uid');
            
            // Tampilkan Nama Tamu di Cover
            if (guestName) {
                document.getElementById('guestNameDisplay').innerText = guestName;
            }

            let targetUID = paramUID || (user ? user.uid : null);
            if (!targetUID) return;

            try {
                const docSnap = await getDoc(doc(db, "invitations", targetUID));
                if (docSnap.exists()) renderData(docSnap.data());
            } catch (e) { console.error(e); }
        });

        function renderData(data) {
            // TEXT
            document.getElementById('coverNames').innerText = (data.groomNick || 'Pria') + " & " + (data.brideNick || 'Wanita');
            
            document.getElementById('groomNameDisplay').innerText = data.groomName;
            document.getElementById('groomParents').innerText = `Bpk. ${data.groomFather} & Ibu ${data.groomMother}`;
            
            document.getElementById('brideNameDisplay').innerText = data.brideName;
            document.getElementById('brideParents').innerText = `Bpk. ${data.brideFather} & Ibu ${data.brideMother}`;

            // IMAGES
            if(data.coverPhoto) {
                document.getElementById('coverBg').src = data.coverPhoto;
                document.getElementById('headerBg').src = data.coverPhoto;
            }
            if(data.groomPhoto) document.getElementById('groomImg').src = data.groomPhoto;
            if(data.bridePhoto) document.getElementById('brideImg').src = data.bridePhoto;

            // ACARA
            if(data.eventDate) {
                const dateObj = new Date(data.eventDate);
                const opts = { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' };
                document.getElementById('dateDisplay').innerText = dateObj.toLocaleDateString('id-ID', opts);
                startCountdown(data.eventDate + "T" + (data.eventTime || "08:00"));
            }
            document.getElementById('timeDisplay').innerText = (data.eventTime || "00:00") + " WITA";
            document.getElementById('locationDisplay').innerText = data.eventLocation;
            if(data.mapsUrl) document.getElementById('btnMap').href = data.mapsUrl;

            // BANK
            document.getElementById('bankNameDisplay').innerText = data.bankName;
            document.getElementById('rekDisplay').innerText = data.accountNumber;
            document.getElementById('rekHolderDisplay').innerText = data.accountHolder;

            // MUSIC
            if(data.music && musicLibrary[data.music]) bgm.src = musicLibrary[data.music];
            else bgm.src = musicLibrary['romance1.mp3'];
        }

        function startCountdown(target) {
            const dest = new Date(target).getTime();
            setInterval(() => {
                const now = new Date().getTime();
                const diff = dest - now;
                if(diff < 0) return;
                document.getElementById('d').innerText = Math.floor(diff / (1000 * 60 * 60 * 24));
                document.getElementById('h').innerText = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                document.getElementById('m').innerText = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                document.getElementById('s').innerText = Math.floor((diff % (1000 * 60)) / 1000);
            }, 1000);
        }
    </script>
</body>
</html>
