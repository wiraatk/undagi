<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Login - Undagi</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body class="bg-gray-100 p-4">

    <div class="max-w-md mx-auto bg-white rounded-xl shadow-lg p-6 mt-10">
        <h1 class="text-2xl font-bold mb-4">Login System</h1>
        
        <div id="debugBox" class="bg-black text-green-400 font-mono text-xs p-4 rounded mb-4 h-48 overflow-y-scroll border-2 border-red-500">
            > System Init...<br>
        </div>

        <button id="btnLogin" class="w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-xl hover:bg-blue-700 transition">
            Masuk dengan Google
        </button>
        
        <a href="index.html" class="block text-center mt-4 text-sm text-gray-500">Kembali ke Beranda</a>
    </div>

    <script type="module">
        // FUNGSI PENCATAT ERROR KE LAYAR
        const debugBox = document.getElementById('debugBox');
        function log(msg, type='info') {
            const color = type === 'error' ? 'red' : 'green';
            debugBox.innerHTML += `<span style="color:${color}">> ${msg}</span><br>`;
            console.log(msg);
        }

        // 1. TANGKAP ERROR GLOBAL
        window.onerror = function(message, source, lineno, colno, error) {
            log(`CRITICAL ERROR: ${message}`, 'error');
            return true;
        };

        log("Mencoba memuat firebase-config.js...");

        try {
            // KITA PAKAI CACHE BUSTING (?v=random) BIAR GITHUB GAK PAKAI FILE LAMA
            const module = await import('./firebase-config.js?v=' + Math.random());
            
            log("Config ditemukan!");
            
            const { auth, provider, signInWithPopup, onAuthStateChanged } = module;

            if(!auth) log("ERROR: 'auth' tidak ditemukan di export!", 'error');
            if(!provider) log("ERROR: 'provider' tidak ditemukan di export! Cek config lagi.", 'error');
            
            if(auth && provider) {
                log("Sistem SIAP! Silakan klik tombol.");
                
                // Cek status login
                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        log(`User terdeteksi: ${user.email}`);
                        log("Redirecting...");
                        window.location.href = "dashboard.html";
                    }
                });

                // Tombol Login
                document.getElementById('btnLogin').addEventListener('click', async () => {
                    log("Tombol diklik. Membuka popup...");
                    try {
                        const result = await signInWithPopup(auth, provider);
                        log("Login SUKSES! Halo " + result.user.displayName);
                        window.location.href = "dashboard.html";
                    } catch (err) {
                        log("LOGIN GAGAL: " + err.message, 'error');
                        log("Code: " + err.code, 'error');
                        Swal.fire('Error', err.message, 'error');
                    }
                });
            }

        } catch (e) {
            log("GAGAL IMPORT CONFIG!", 'error');
            log(e.message, 'error');
            log("Saran: Cek file firebase-config.js di GitHub, pastikan tidak ada typo.", 'error');
        }
    </script>
</body>
</html>
